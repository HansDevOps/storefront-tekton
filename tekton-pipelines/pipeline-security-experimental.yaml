apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: security-pipeline
spec:
  resources:
    - name: git-source
      type: git
    - name: docker-image
      type: image
  tasks:
    - name: appsody-build
      taskRef:
        name: aot-mockup
    - name: copy-2-icr
      taskRef:
        name: aot-mockup
      runAfter: 
      - appsody-build
    - name: copy-2-quay
      taskRef:
        name: aot-mockup
      runAfter: 
      - appsody-build
    - name: sonar-scan
      taskRef:
        name: aot-mockup
      runAfter: 
      - copy-2-quay
      - copy-2-icr
    - name: owasp-scan
      taskRef:
        name: aot-mockup
      runAfter: 
      - copy-2-quay
      - copy-2-icr
    - name: quay-va-scan
      taskRef:
        name: aot-mockup
      runAfter: 
      - sonar-scan
      - owasp-scan
    - name: icr-va-scan
      taskRef:
        name: aot-mockup
      runAfter: 
      - sonar-scan
      - owasp-scan
    - name: trivy-va-scan
      taskRef:
        name: aot-mockup
      runAfter: 
      - sonar-scan
      - owasp-scan
    - name: roll-out
      taskRef:
        name: aot-mockup
      runAfter: 
      - icr-va-scan
      - quay-va-scan
      - trivy-va-scan      
